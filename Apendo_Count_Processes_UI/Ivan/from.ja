<!DOCTYPE html>
<html>

<head>
    <title>Camunda API-formulär</title>
</head>

<body>
    <form onsubmit="event.preventDefault(); submitForm();">
        <label for="processInstanceId">Processinstans ID:</label>
        <input type="text" id="processInstanceId" name="processInstanceId"><br><br>
        <button type="submit">Hämta uppgifter</button>
    </form>

    <div id="result"></div>

    <script>
        function submitForm() {
            const processInstanceId = document.getElementById("processInstanceId").value;
            const apiUrl = `http://wsprakt3.apendo.se:9200/_search/`;

            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    const resultDiv = document.getElementById("result");
                    resultDiv.innerHTML = JSON.stringify(data.hits.total, null, 2);


                    const processInstanceIds = processInstanceId.split(",");
                    console.log("dont work");
                    $.each(processInstanceIds, (index, processInstanceId) => {
                        const url = apiUrl + processInstanceId.trim() + "/variables";
                        $.get(url)
                            .done((data) => {
                                // add table header if this is the first result
                                if (index === 0) {
                                    const tableHtml = "<table><thead><tr><th>Process Instance ID</th><th>Variable Name</th><th>Value</th></tr></thead><tbody></tbody></table>";
                                    resultDiv.innerHTML += tableHtml;
                                }

                                // add row for each variable
                                $.each(data, (variableName, variableData) => {
                                    const rowHtml = `<tr><td>${processInstanceId}</td><td>${variableName}</td><td>${variableData.value}</td></tr>`;
                                    resultDiv.querySelector("tbody").innerHTML += rowHtml;
                                });
                            })
                            .fail((xhr) => {
                                resultDiv.innerHTML += `Error getting variables for process instance ${processInstanceId}: ${xhr.responseText}`;
                            });
                    });
                })
                .catch(error => console.error(error));
        }
    </script>
</body>

</html>